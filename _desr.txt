Решениие на PL/SQL плохо масштабируется. Попробую использовать вариант на таблице инстансов ошибок по Кимбаллу